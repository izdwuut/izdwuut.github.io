<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Host a Flask app using Apache and mod_wsgi - izdwuut's personal place</title><meta name=description content="Now that dust has settled after Youtube Thumbnail Downloader tutorial, it&rsquo;s time for a new thing. When you run a Flask developement server, it tells you that it isn&rsquo;t suited for prodution:
WARNING: This is a developlment server. Do not use it in a production deployment.Fair point. It hasn&rsquo;t been tested for security and whatnot. There are a few alternatives, most notably Nginx and Apache. I go for the latter."><meta name=author content="izdwuut"><link rel=stylesheet href=/css/bundle.min.277d2cec16dea5cb8a23754f9b4fb21239187cb45a8ca3269e8ac6831bd12bc8.css integrity="sha256-J30s7BbepcuKI3VPm0+yEjkYfLRajKMmnorGgxvRK8g="><link rel=apple-touch-icon href=/img/apple-touch-icon.png><link rel=icon href=/img/favicon.png><meta name=generator content="Hugo 0.75.1"><link rel=alternate type=application/atom+xml href=/index.xml title="izdwuut's personal place"></head><body class=single><header class=header><button type=button onclick=openNav() class=menu-toggle></button><nav class=sidenav id=mySidenav><a href=javascript:void(0) class=closebtn onclick=closeNav()>&#215;</a><ul><li><a href=/>Home</a></li><li><a href=/tutorials/>Tutorials</a></li><li><a href=/bugs/>Reported bugs</a></li><li><a href=/reviews/>Reviews</a></li><li><a href=/about/>About me</a></li></ul></nav><p class=title><a href=/>izdwuut's personal place</a></p></header><main class=main id=main><article class="post post-view"><header class=post-header><h1 class=post-title>Host a Flask app using Apache and mod_wsgi</h1><p class=post-meta><p class=post-meta>Written on 2020-02-23
by izdwuut.</p></p><div class=tags><ul class=post-tags><li><a href=/tags/python/>Python</a></li><li><a href=/tags/server/>Server</a></li><li><a href=/tags/wsgi/>WSGI</a></li><li><a href=/tags/ubuntu/>Ubuntu</a></li><li><a href=/tags/apache/>Apache</a></li><li><a href=/tags/flask/>Flask</a></li></ul></div></header><div class=tutorial-meta><div class=topics><h3>Topics covered</h3><ul><li>Apache</li><li>WSGI</li><li>Ubuntu</li></ul></div><div class=pre-req><h3>Used libraries</h3><ul><li>Flask</li></ul></div><footer class=sources><i class="fab fa-github"></i><a href=https://github.com/izdwuut/flask-wsgi>Sources</a></footer></div><div class=post-content><p>Now that dust has settled after <a href=/tutorials/youtube-thumbnail-downloader/>Youtube Thumbnail Downloader</a> tutorial, it&rsquo;s time for a new thing. When you run a Flask developement server, it tells you that it isn&rsquo;t suited for prodution:</p><pre><code>WARNING: This is a developlment server. Do not use it in a production deployment.
</code></pre><p>Fair point. It hasn&rsquo;t been tested for security and whatnot. There are a few alternatives, most notably <a href=https://www.nginx.com/>Nginx</a> and <a href=https://httpd.apache.org/>Apache</a>. I go for the latter. I assume that you have <a href=https://ubuntu.com/>Ubuntu</a> server up and running. I won&rsquo;t actually cover developing a Flask application. I will use a simple example that only demonstrates WSGI configuration. I think that the whole process is straightforward. Let&rsquo;s go!</p><h1 id=installing-libraries>Installing libraries</h1><p>We start with installing required packages. First, make sure your system is up to date:</p><pre><code>sudo apt update &amp;&amp; upgrade
</code></pre><p>We are going to need some packages on our system, most notably Apache and Python. Issue the following command to install them:</p><pre><code>sudo apt-get install apache2 libapache2-mod-wsgi-py3 python3 python3-pip python3-venv git curl
</code></pre><p>Not too much of a sweat, isn&rsquo;t it?</p><h1 id=cloning-sources>Cloning sources</h1><p>Change directory to home:</p><pre><code>cd ~
</code></pre><p>Then clone the repository:</p><pre><code>https://github.com/izdwuut/flask-wsgi &amp;&amp; cd flask-wsgi
</code></pre><p>It&rsquo;s a pretty standard Flask app that utilizes <a href=https://flask.palletsprojects.com/en/1.1.x/patterns/appfactories/>app factory</a> pattern. The only file worth mentioning is wsgi.py. It tells the server how to run our app. Let&rsquo;s take a closer look:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> app <span style=color:#f92672>import</span> create_app

application <span style=color:#f92672>=</span> create_app()</code></pre></td></tr></table></div></div><p><code>3.</code> This is all we have to do - create our application instance using <code>create_app</code> imported from <code>app</code> module.</p><h1 id=adding-virtual-environment>Adding virtual environment</h1><p>Before we proceed, we need to create a Python virtual environment. While in <code>flask-wsgi</code> directory, issue the following command to install and activate venv:</p><pre><code>python3 -m venv venv &amp;&amp; source venv/bin/activate
</code></pre><p>Now we can install our requirements:</p><pre><code>pip3 install -r requirements.txt
</code></pre><h1 id=hosting-the-files>Hosting the files</h1><p>To host our app, we need to copy our sources to <code>/var/www</code> directory. Run the following command:</p><pre><code>sudo cp . /var/www/flask-wsgi -r
</code></pre><p>To actually run the app, Apache must be configured first.</p><h1 id=running-apache-and-adding-a-site>Running Apache and adding a site</h1><p>The following command will start Apache. You will be prompted for your user&rsquo;s password:</p><pre><code>systemctl start apache2
</code></pre><p>Apache utilizes a concept of sites. They are config files for your&mldr; well, sites. They contain all the data about your website (or a Flask app in our case), from directory on server to port which Apache listens on. They reside in <code>/etc/apache2/sites-available</code>. Let&rsquo;s create our site:</p><pre><code>sudo touch /etc/apache2/sites-available/flask-wsgi.conf
</code></pre><p>Put the following lines in it:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-apache data-lang=apache>Listen <span style=color:#ae81ff>5000</span>
<span style=color:#f92672>&lt;VirtualHost</span> <span style=color:#e6db74>*:5000</span><span style=color:#f92672>&gt;</span>
	ServerName <span style=color:#ae81ff>127.0.0.1</span>
	WSGIScriptAlias / <span style=color:#e6db74>/var/www/flask-wsgi/wsgi.py</span>
	WSGIDaemonProcess flask-wsgi python-path=/var/www/flask-wsgi/venv/lib/python3.6/site-packages:/var/www/flask-wsgi
	WSGIProcessGroup flask-wsgi
	<span style=color:#f92672>&lt;Directory</span> <span style=color:#e6db74>/var/www/flask-wsgi/app/</span><span style=color:#f92672>&gt;</span>
		Order allow,deny
		Allow from <span style=color:#66d9ef>all</span>
	<span style=color:#f92672>&lt;/Directory&gt;</span>
	ErrorLog ${APACHE_LOG_DIR}/error.log
	LogLevel <span style=color:#66d9ef>warn</span>
	CustomLog ${APACHE_LOG_DIR}/access.log combined
<span style=color:#f92672>&lt;/VirtualHost&gt;</span></code></pre></td></tr></table></div></div><p><code>1.</code> Tells the Apache to listen on port <code>5000</code>. You are free to change it to any value you want, just remember to also change it in line 2.</p><p><code>3.</code> Your server name. In our case it&rsquo;s localhost loopback address.</p><p><code>4.</code> The first argument tells apache to serve your app at <code>/</code>, and the second tells where the WSGI config is located at.</p><p><code>5.</code> Here we spawn a process named <code>flask-wsgi</code> and add two values to Python path separated by a colon:</p><ul><li><code>/var/www/flask-wsgi/venv/lib/python3.6/site-packages</code> - location of site packages in virtual environment. Change the <code>python3.6</code> bit if you use different version of Python.</li><li><code>/var/www/flask-wsgi</code> - location of our script on server</li></ul><p><code>6.</code> Create process group <code>flask-wsgi</code>.</p><p><code>7.</code> Set application directory. Note that it points to <code>app</code> directory.</p><p><code>9</code>. Allow all connections.</p><p><code>11-13.</code> Add logging. <code>${APACHE_LOG_DIR}</code> stands for <code>/var/log/apache2</code>.</p><p>Having that, we can activate the site:</p><pre><code>sudo a2ensite flask-wsgi.conf &amp;&amp; sudo service apache2 reload
</code></pre><h1 id=testing-the-application>Testing the application</h1><p>The application should be up and running. Check it using <code>curl</code>:</p><pre><code>curl 127.0.0.1:5000
</code></pre><p>This is the output you should get:</p><pre><code>Hello world!
</code></pre><p>And that&rsquo;s it. Thanks for your attention!</p></div><footer class=post-footer><ul class=post-tags><li><a href=/tags/python/>Python</a></li><li><a href=/tags/server/>Server</a></li><li><a href=/tags/wsgi/>WSGI</a></li><li><a href=/tags/ubuntu/>Ubuntu</a></li><li><a href=/tags/apache/>Apache</a></li><li><a href=/tags/flask/>Flask</a></li></ul></footer><div class=cd>&#x1F4BF;</div></article></main><footer class=footer><span>Made with <i style=color:red class="fas fa-heart"></i>by
<a href=/about>Bartosz "izdwuut" Konikiewicz</a></span>
<span>&#183;</span>
<span><a href=https://github.com/izdwuut/izdwuut.github.io/tree/dev><img src=/img/github.png class=service-logo> Sources (MIT license)</a></span>
<span>&#183;</span>
<span>Fueled by <a href=https://gohugo.io/ target=_blank><img src=/img/hugo.svg class=service-logo></a>️</span></footer><div id=overlay></div><div class=funny-bits></div><script src=/js/bundle.min.4dbe5443171a6f71eaf447210187832a2f892b495e9b77b7f78bf37532a8e11b.js integrity="sha256-Tb5UQxcab3Hq9EchAYeDKi+JK0lem3e394vzdTKo4Rs="></script><script data-no-instant>InstantClick.init();</script></body></html>